# ç±»å‹æ”¶çª„ï¼ˆNarrowingï¼‰

> ğŸš€ã€TypeScriptå…¥é—¨æ‰‹å†Œã€‘è®°å½•äº†å‡ºåœºç‡è¾ƒé«˜çš„Tsæ¦‚å¿µï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶äº†è§£å¹¶ç†Ÿæ‚‰Ts  
> ğŸ‰ æœ¬ç³»åˆ—ä¼šæŒç»­æ›´æ–°å¹¶æ›´æ­£ï¼Œé‡ç‚¹å…³ç…§å¤§å®¶æ„Ÿå…´è¶£çš„ç‚¹ï¼Œæ¬¢è¿åŒå­¦ç•™è¨€äº¤æµï¼Œåœ¨è¿›é˜¶ä¹‹è·¯ä¸Šï¼Œå…±å‹‰ï¼  
> <font color="red">staræœ¬é¡¹ç›®ç»™ä½œè€…ä¸€ç‚¹é¼“åŠ±å§</font>  

## ä¸€ã€è®¤è¯†Narrowing

è¯•æƒ³æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åä¸º padLeftï¼š

è¯¥å‡½æ•°å®ç°çš„åŠŸèƒ½æ˜¯ï¼šå¦‚æœå‚æ•° padding æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å°±åœ¨ input å‰é¢æ·»åŠ åŒç­‰æ•°é‡çš„ç©ºæ ¼ï¼Œè€Œå¦‚æœ padding æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°±ç›´æ¥æ·»åŠ åˆ° input å‰é¢ã€‚

è®©æˆ‘ä»¬å®ç°ä¸€ä¸‹è¿™ä¸ªé€»è¾‘ï¼š

```ts
function padLeft(padding: number | string, input: string) {
    return new Array(padding + 1).join(" ") + input;
    // è¿ç®—ç¬¦â€œ+â€ä¸èƒ½åº”ç”¨äºç±»å‹â€œstring | numberâ€å’Œâ€œnumberâ€
}
```

å¦‚æœè¿™æ ·å†™çš„è¯ï¼Œç¼–è¾‘å™¨é‡Œ `padding + 1` è¿™ä¸ªåœ°æ–¹å°±ä¼šæ ‡çº¢ï¼Œæ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ã€‚â€‹è¿™æ˜¯ TypeScript åœ¨è­¦å‘Šæˆ‘ä»¬ï¼Œå¦‚æœæŠŠä¸€ä¸ª `number` ç±»å‹ (å³ä¾‹å­é‡Œçš„æ•°å­— 1 )å’Œä¸€ä¸ª `number | string` ç±»å‹ç›¸åŠ ï¼Œä¹Ÿè®¸å¹¶ä¸ä¼šè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆæ£€æŸ¥ä¸‹ `padding` æ˜¯å¦æ˜¯ä¸€ä¸ª `number`:

```ts
function padLeft(padding: number | string, input: string) {
    if (typeof padding === "number") {
        return new Array(padding + 1).join(" ") + input;
    }
    return padding + input;
}


console.log(padLeft(10, "å“ˆå“ˆ"));
```

è¿™ä¸ªä»£ç çœ‹ä¸Šå»ä¹Ÿè®¸æ²¡æœ‰ä»€ä¹ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼Œä½†å®é™…ä¸Šï¼ŒTypeScript åœ¨èƒŒååšäº†å¾ˆå¤šä¸œè¥¿ã€‚

TypeScript è¦å­¦ç€åˆ†æè¿™äº›ä½¿ç”¨äº†é™æ€ç±»å‹çš„å€¼åœ¨è¿è¡Œæ—¶çš„å…·ä½“ç±»å‹ã€‚ç›®å‰ TypeScript å·²ç»å®ç°äº†æ¯”å¦‚ if/else ã€ä¸‰å…ƒè¿ç®—ç¬¦ã€å¾ªç¯ã€çœŸå€¼æ£€æŸ¥ç­‰æƒ…å†µä¸‹çš„ç±»å‹åˆ†æã€‚

åœ¨æˆ‘ä»¬çš„ if è¯­å¥ä¸­ï¼ŒTypeScript ä¼šè®¤ä¸º `typeof padding === number` æ˜¯ä¸€ç§ç‰¹æ®Šå½¢å¼çš„ä»£ç ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç±»å‹ä¿æŠ¤` (type guard)`ï¼ŒTypeScript ä¼šæ²¿ç€æ‰§è¡Œæ—¶å¯èƒ½çš„è·¯å¾„ï¼Œåˆ†æå€¼åœ¨ç»™å®šçš„ä½ç½®ä¸Šæœ€å…·ä½“çš„ç±»å‹ã€‚

TypeScript çš„ç±»å‹æ£€æŸ¥å™¨ä¼šè€ƒè™‘åˆ°è¿™äº›ç±»å‹ä¿æŠ¤å’Œèµ‹å€¼è¯­å¥ï¼Œè€Œè¿™ä¸ªå°†ç±»å‹æ¨å¯¼ä¸ºæ›´ç²¾ç¡®ç±»å‹çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º**æ”¶çª„ (narrowing)**ã€‚ åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ç±»å‹çš„æ”¹å˜ï¼š

```ts
function padLeft(padding: number | string, input: string) {
    if (typeof padding === "number") {
        return new Array(padding + 1).join(" ") + input;
        // (parameter) padding: number
    }
    return padding + input;
    // (parameter) padding: string
}
```

ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°åœ¨ if è¯­å¥ä¸­ï¼Œå’Œå‰©ä½™çš„ return è¯­å¥ä¸­ï¼Œpadding çš„ç±»å‹éƒ½æ¨å¯¼ä¸ºæ›´ç²¾ç¡®çš„ç±»å‹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»‹ç» narrowing æ‰€æ¶‰åŠçš„å„ç§å†…å®¹ã€‚

## äºŒã€typeofæ”¶çª„ï¼ˆtype guardsï¼‰

JavaScript æœ¬èº«å°±æä¾›äº† typeof æ“ä½œç¬¦ï¼Œå¯ä»¥è¿”å›è¿è¡Œæ—¶ä¸€ä¸ªå€¼çš„åŸºæœ¬ç±»å‹ä¿¡æ¯ï¼Œä¼šè¿”å›å¦‚ä¸‹è¿™äº›ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼š

* "string"
* "number"
* "bigInt"
* "boolean"
* "symbol"
* "undefined"
* "object"
* "function"

`typeof`æ“ä½œç¬¦åœ¨å¾ˆå¤š JavaScript åº“ä¸­éƒ½æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œè€Œ TypeScript å·²ç»å¯ä»¥åšåˆ°ç†è§£å¹¶åœ¨ä¸åŒçš„åˆ†æ”¯ä¸­å°†ç±»å‹æ”¶çª„ã€‚â€‹åœ¨ TypeScript ä¸­ï¼Œæ£€æŸ¥`typeof`è¿”å›çš„å€¼å°±æ˜¯ä¸€ç§ç±»å‹ä¿æŠ¤ã€‚

```ts
function getText(str: number | string): string {
    if (typeof str === "number") {
        return `${str} isNumber`;
        // (parameter) str: number
    } else {
        return `${str} isString`;
        // (parameter) str: string
    }
}
```

## ä¸‰ã€ç­‰å€¼æ”¶çª„ï¼ˆEquality narrowingï¼‰

Typescript ä¹Ÿä¼šä½¿ç”¨ switch è¯­å¥å’Œç­‰å€¼æ£€æŸ¥æ¯”å¦‚ == !== == != å»æ”¶çª„ç±»å‹ã€‚æ¯”å¦‚ï¼š

```ts
function getText(a: string | boolean, b: string | null): void {
    if (a === b) {
        console.log(a);
        console.log(b);
        // (parameter) a: string
        // (parameter) b: string
    } else {
        console.log(a);
        console.log(b);
        // (parameter) a: string | boolean
        // (parameter) b: string
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ¤æ–­äº†`x`å’Œ`y`æ˜¯å¦å®Œå…¨ç›¸ç­‰ï¼Œå¦‚æœå®Œå…¨ç›¸ç­‰ï¼Œé‚£ä»–ä»¬çš„ç±»å‹è‚¯å®šä¹Ÿå®Œå…¨ç›¸ç­‰ã€‚è€Œ`string`ç±»å‹å°±æ˜¯`x`å’Œ`y`å”¯ä¸€å¯èƒ½çš„ç›¸åŒç±»å‹ã€‚æ‰€ä»¥åœ¨ç¬¬ä¸€ä¸ªåˆ†æ”¯é‡Œï¼Œ`x`å’Œ`y`å°±ä¸€å®šæ˜¯ string ç±»å‹ã€‚â€‹åˆ¤æ–­å…·ä½“çš„å­—é¢é‡å€¼ä¹Ÿèƒ½è®© TypeScript æ­£ç¡®çš„åˆ¤æ–­ç±»å‹ã€‚

## å››ã€in æ“ä½œç¬¦æ”¶çª„

JavaScript ä¸­æœ‰ä¸€ä¸ª in æ“ä½œç¬¦å¯ä»¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰å¯¹åº”çš„å±æ€§åã€‚TypeScript ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ”¶çª„ç±»å‹ã€‚â€‹ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ "value" in x ä¸­ï¼Œ"value" æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œè€Œ x æ˜¯ä¸€ä¸ªè”åˆç±»å‹ï¼š

```ts
type Dog = { ww: "1"; mm?: "2" };
type Cat = { mm: "1" };

function inDemo(animal: Dog | Cat): void {
    if ("ww" in animal) {
        console.log(animal);
        // (parameter) animal: Dog
    } else {
        console.log(animal);
        // (parameter) animal: Cat
    }
}
```

é€šè¿‡ "ww" in animal ï¼Œæˆ‘ä»¬å¯ä»¥å‡†ç¡®çš„è¿›è¡Œç±»å‹æ”¶çª„ã€‚

è€Œå¦‚æœæœ‰å¯é€‰å±æ€§ï¼ŒTsä¹Ÿä¼šæ£€æµ‹å‡ºæ¥ï¼š

```ts
type Dog = { ww: "1"; mm?: "2" };
type Cat = { mm: "1" };

function inDemo(animal: Dog | Cat): void {
    if ("mm" in animal) {
        console.log(animal);
        // (parameter) animal: Dog | Cat
    } else {
        console.log(animal);
        // (parameter) animal: Cat
    }
}
```

## äº”ã€instanceof æ”¶çª„

instanceof ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ä¿æŠ¤ï¼ŒTypeScript ä¹Ÿå¯ä»¥é€šè¿‡è¯†åˆ« instanceof æ­£ç¡®çš„ç±»å‹æ”¶çª„ï¼š

```ts
function instanceofDemo(a: object | number): void {
    if (a instanceof String) {
        console.log(a);
        // (parameter) a: String
    } else {
        console.log(a);
        // (parameter) a: number | object
    }
}
```

## å…­ã€èµ‹å€¼è¯­å¥ï¼ˆAssignmentsï¼‰

TypeScript å¯ä»¥æ ¹æ®èµ‹å€¼è¯­å¥çš„å³å€¼ï¼Œæ­£ç¡®çš„æ”¶çª„å·¦å€¼ã€‚

```ts
let x = Math.random() > 0.5 ? "abc" : 123;

x = 1;
// let x: string | number
console.log(x);
// let x: number
x = "1";
// let x: string | number
console.log(x);
// let x: string
```

æ³¨æ„è¿™äº›èµ‹å€¼è¯­å¥éƒ½æœ‰æœ‰æ•ˆçš„ï¼Œå³ä¾¿æˆ‘ä»¬å·²ç»å°† x æ”¹ä¸º number ç±»å‹ï¼Œä½†æˆ‘ä»¬ä¾ç„¶å¯ä»¥å°†å…¶æ›´æ”¹ä¸º string ç±»å‹ï¼Œè¿™æ˜¯å› ä¸º x æœ€åˆçš„å£°æ˜ä¸º string | numberï¼Œèµ‹å€¼çš„æ—¶å€™åªä¼šæ ¹æ®æ­£å¼çš„å£°æ˜è¿›è¡Œæ ¸å¯¹ã€‚â€‹

## å†™åœ¨æœ€å

æœ¬ç¯‡æ–‡ç« æ˜¯ã€ŠTypescriptåŸºç¡€å…¥é—¨ã€‹ç¬¬äºŒç¯‡ï¼Œæ”¶çª„æ˜¯ä¸€ç»„æ¯”è¾ƒéš¾ç†è§£çš„æ€è·¯ï¼Œè¿™é‡Œä»…æåˆ°éƒ¨åˆ†å¸¸è§çš„å½¢å¼ï¼Œä¸€èµ·å…±å‹‰å§ï¼

**å‚è€ƒï¼š**

* [TypeScript4 ä¸­æ–‡æ–‡æ¡£](https://mqyqingfeng.github.io/learn-typescript/handbook/Narrowing.html#narrowing)

**å…³äºæˆ‘ï¼š**

* èŠ±åï¼šä½™å…‰
* é‚®ç®±ï¼šwebbj97@163.com
* csdnï¼š[ä¼ é€é—¨](https://blog.csdn.net/jbj6568839z)

**å…¶ä»–æ²‰æ·€:**

* [Github: Jsç‰ˆLeetCodeé¢˜è§£](https://webbj97.github.io/leetCode-Js/)
* [ä½™å…‰çš„å‰ç«¯æˆé•¿ç¬”è®°](https://github.com/webbj97/summary)
* [é«˜é¢‘æ‰‹æ’•ä»£ç ç³»åˆ—](https://github.com/webbj97/fe-questions) 

<p align=center>
	<img src="https://hlgcdn.oss-cn-hangzhou.aliyuncs.com/hlg-ui/1607504321645897/yuguang-vue-bottom.gif" width="100%"/>
</p>
